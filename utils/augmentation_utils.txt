import os, numpy as np
from PIL import Image

def augment_image_folder(input_dir, output_dir, pipeline, num_augmented_per_image=5):
    os.makedirs(output_dir, exist_ok=True)
    for fname in os.listdir(input_dir):
        if not fname.lower().endswith(('.png','.jpg','.jpeg')):
            continue
        img = np.array(Image.open(os.path.join(input_dir, fname)))
        base, _ = os.path.splitext(fname)
        for i in range(num_augmented_per_image):
            aug = pipeline(image=img)['image']
            Image.fromarray(aug).save(os.path.join(output_dir, f"{base}_aug{i}.png"))